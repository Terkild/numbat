<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Visualizing and interpreting Numbat outputs">
<title>Interpreting Numbat results â€¢ numbat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpreting Numbat results">
<meta property="og:description" content="Visualizing and interpreting Numbat outputs">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">numbat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/numbat.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/results.html">Interpreting Numbat results</a>
    <a class="dropdown-item" href="../articles/hmm.html">Numbat haplotype-aware HMM</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interpreting Numbat results</h1>
            
      
      
      <div class="d-none name"><code>results.Rmd</code></div>
    </div>

    
    
<p>In this tutorial, we will illustrate how to visualize and interpret Numbat output, using a triple-negative breast cancer dataset (TNBC1) from <a href="https://www.nature.com/articles/s41587-020-00795-2" class="external-link">Gao et al</a>. We will use <a href="https://github.com/kharchenkolab/pagoda2" class="external-link">pagoda2</a> for visualizing cells in low-dimensional expression space.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">numbat</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/treedata-book/" class="external-link">ggtree</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidygraph.data-imaginist.com" class="external-link">tidygraph</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize output files into a Numbat object</span>
<span class="va">nb</span> <span class="op">=</span> <span class="va"><a href="../reference/Numbat.html">Numbat</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>out_dir <span class="op">=</span> <span class="st">'~/paper_data/numbat_out/TNBC1_demo'</span><span class="op">)</span>
<span class="co"># load pre-saved pagoda2 object</span>
<span class="va">pagoda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">'~/paper_data/conos_objects/TNBC1.rds'</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="copy-number-landscape-and-single-cell-phylogeny">Copy number landscape and single-cell phylogeny<a class="anchor" aria-label="anchor" href="#copy-number-landscape-and-single-cell-phylogeny"></a>
</h2>
<p>As an overview, we can visualize the CNV calls in single-cells and their evolutionary relationships in an integrated plot panel:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mypal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gray'</span>, <span class="st">"#377EB8"</span>, <span class="st">"#4DAF4A"</span>, <span class="st">"#984EA3"</span><span class="op">)</span>
  
<span class="va">nb</span><span class="op">$</span><span class="fu">plot_phylo_heatmap</span><span class="op">(</span>
  clone_bar <span class="op">=</span> <span class="cn">TRUE</span>, 
  p_min <span class="op">=</span> <span class="fl">0.9</span>,
  pal_clone <span class="op">=</span> <span class="va">mypal</span>
<span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-4-1.png" width="2400"> In this visualization, the single-cell phylogeny (left) is juxtaposed with a heatmap of single-cell CNV calls (right). The CNV calls are colored by the type of alterations (AMP, amplification, BAMP, balanced amplification, DEL, deletion, CNLoH, copy-neutral loss of heterozygosity). The colorbar in-between differentiates the distinct genetic populations (genotype). The dashed blue line separates the predicted tumor versus normal cells. This tells us that the dataset mainly consists of three cell populations, a normal population (gray) and two tumor subclones (green and yellow).</p>
</div>
<div class="section level2">
<h2 id="consensus-copy-number-segments">Consensus copy number segments<a class="anchor" aria-label="anchor" href="#consensus-copy-number-segments"></a>
</h2>
<p>Let's take a look at the consensus segments.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span><span class="op">$</span><span class="fu">plot_consensus</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-5-1.png" width="4200"></p>
</div>
<div class="section level2">
<h2 id="bulk-cnv-profiles">Bulk CNV profiles<a class="anchor" aria-label="anchor" href="#bulk-cnv-profiles"></a>
</h2>
<p>We can also visualize these CNV events in pseudobulks where the data is more rich, aggregating cells by clone:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span><span class="op">$</span><span class="va">bulk_clones</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/plot_bulks.html">plot_bulks</a></span><span class="op">(</span>
    min_LLR <span class="op">=</span> <span class="fl">50</span>, <span class="co"># filtering CNVs by evidence</span>
    legend <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-6-1.png" width="3600"></p>
</div>
<div class="section level2">
<h2 id="single-cell-cnv-calls">Single-cell CNV calls<a class="anchor" aria-label="anchor" href="#single-cell-cnv-calls"></a>
</h2>
<p>Numbat probabilistically evaluates the presence/absence of CNVs in single cells. The cell-level CNV posteriors are stored in the <code>nb$joint_post</code> dataframe:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nb</span><span class="op">$</span><span class="va">joint_post</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cell</span>, <span class="va">CHROM</span>, <span class="va">seg</span>, <span class="va">cnv_state</span>, <span class="va">p_cnv</span>, <span class="va">p_cnv_x</span>, <span class="va">p_cnv_y</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                        cell CHROM     seg cnv_state     p_cnv   p_cnv_x</span>
<span class="co">## 1: TNBC1_AAACCTGCACCTTGTC-1    10     10a       amp 0.4316952 0.8213868</span>
<span class="co">## 2: TNBC1_AAACCTGCACCTTGTC-1    11     11c       amp 0.8805083 0.8409645</span>
<span class="co">## 3: TNBC1_AAACCTGCACCTTGTC-1    15     15b       amp 0.6784848 0.6735659</span>
<span class="co">## 4: TNBC1_AAACCTGCACCTTGTC-1    16 16a_amp       amp 0.3294931 0.9999968</span>
<span class="co">## 5: TNBC1_AAACCTGCACCTTGTC-1    18     18b       amp 0.9111163 0.4631554</span>
<span class="co">## 6: TNBC1_AAACCTGCACCTTGTC-1     1      1a       amp 0.3727175 0.3722562</span>
<span class="co">##      p_cnv_y</span>
<span class="co">## 1: 0.1392836</span>
<span class="co">## 2: 0.5810528</span>
<span class="co">## 3: 0.4253511</span>
<span class="co">## 4: 0.4226886</span>
<span class="co">## 5: 0.9346981</span>
<span class="co">## 6: 0.5000000</span></code></pre>
<p>which contains cell-level information on specific CNV segments (<code>seg</code>), their alteration type (<code>cnv_state</code>), the joint posterior probability of the CNV (<code>p_cnv</code>), the expression-based posterior (<code>p_cnv_x</code>), and the allele-based posterior (<code>p_cnv_y</code>). We can visualize the event-specific posteriors in a expression-based tSNE embedding:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">muts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1b'</span>, <span class="st">'3c'</span>, <span class="st">'4c'</span><span class="op">)</span>
<span class="va">cnv_type</span> <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">joint_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">seg</span>, <span class="va">cnv_state</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">cnv_state</span>, <span class="va">.</span><span class="op">$</span><span class="va">seg</span><span class="op">)</span><span class="op">}</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">mut</span> <span class="kw">in</span> <span class="va">muts</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="va">plist</span><span class="op">[[</span><span class="va">mut</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="va">pagoda</span><span class="op">$</span><span class="fu">plotEmbedding</span><span class="op">(</span>
        alpha<span class="op">=</span><span class="fl">0.8</span>,
        size<span class="op">=</span><span class="fl">1</span>, 
        plot.na <span class="op">=</span> <span class="cn">F</span>, 
        colors <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">joint_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
            <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">seg</span> <span class="op">==</span> <span class="va">mut</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
            <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">p_cnv</span>, <span class="va">.</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">}</span>,
        show.legend <span class="op">=</span> <span class="cn">T</span>,
        mark.groups <span class="op">=</span> <span class="cn">F</span>,
        plot.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,
        title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">mut</span>, <span class="st">'('</span>, <span class="va">cnv_type</span>, <span class="st">')'</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'royalblue'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red3'</span>, midpoint <span class="op">=</span> <span class="fl">0.5</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">'Posterior'</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">plist</span>, guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-8-1.png" width="2700"></p>
</div>
<div class="section level2">
<h2 id="clonal-assignments">Clonal assignments<a class="anchor" aria-label="anchor" href="#clonal-assignments"></a>
</h2>
<p>Numbat aggregates signals across subclone-specific CNVs to probabilistically assign cells to subclones. The information regarding clonal assignments are contained in the <code>nb$clone_post</code> dataframe.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span><span class="op">$</span><span class="va">clone_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">cell</span>, <span class="va">clone_opt</span>, <span class="va">p_1</span>, <span class="va">p_2</span>, <span class="va">p_3</span>, <span class="va">p_4</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##                        cell clone_opt          p_1          p_2          p_3</span>
<span class="co">## 1: TNBC1_AAACCTGCACCTTGTC-1         4 5.081008e-57 2.300414e-16 7.396132e-27</span>
<span class="co">## 2: TNBC1_AAACGGGAGTCCTCCT-1         1 1.000000e+00 2.232812e-51 1.591547e-84</span>
<span class="co">## 3: TNBC1_AAACGGGTCCAGAGGA-1         4 1.427456e-81 5.475283e-09 3.109571e-26</span>
<span class="co">## 4: TNBC1_AAAGATGCAGTTTACG-1         3 2.141061e-18 2.950639e-04 6.176669e-01</span>
<span class="co">## 5: TNBC1_AAAGCAACAGGAATGC-1         4 1.704233e-51 8.305804e-09 3.074182e-30</span>
<span class="co">## 6: TNBC1_AAAGCAATCGGAATCT-1         3 3.121428e-84 1.001983e-25 1.000000e+00</span>
<span class="co">##             p_4</span>
<span class="co">## 1: 1.000000e+00</span>
<span class="co">## 2: 1.744050e-65</span>
<span class="co">## 3: 1.000000e+00</span>
<span class="co">## 4: 3.820380e-01</span>
<span class="co">## 5: 1.000000e+00</span>
<span class="co">## 6: 9.979171e-24</span></code></pre>
<p>Here <code>clone_opt</code> denotes the maximum likelihood assignment of a cell to a specific clone. <code>p_{1..4}</code> are the detailed breakdown of the posterior probability that the cell belongs to each clone, respectively. Let's visualize the clonal decomposition in a tSNE embedding. Note that clone 1 is always the normal cells.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pagoda</span><span class="op">$</span><span class="fu">plotEmbedding</span><span class="op">(</span>
    alpha<span class="op">=</span><span class="fl">0.8</span>,
    size<span class="op">=</span><span class="fl">1</span>, 
    groups <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">clone_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">clone_opt</span>, <span class="va">.</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">}</span>,
    plot.na <span class="op">=</span> <span class="cn">F</span>,
    plot.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">'Genotypes'</span>,
    pal <span class="op">=</span> <span class="va">mypal</span>
<span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-10-1.png" width="900"></p>
</div>
<div class="section level2">
<h2 id="tumor-versus-normal-probability">Tumor versus normal probability<a class="anchor" aria-label="anchor" href="#tumor-versus-normal-probability"></a>
</h2>
<p>Combining evidence from all CNVs, Numbat derives an aneuploidy probability for each cell to distinguish tumor versus normal cells. We can visualize the posterior aneuploidy probability based on expression evidence only, allele evidence only, and jointly:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_joint</span> <span class="op">=</span> <span class="va">pagoda</span><span class="op">$</span><span class="fu">plotEmbedding</span><span class="op">(</span>
    alpha<span class="op">=</span><span class="fl">0.8</span>,
    size<span class="op">=</span><span class="fl">1</span>, 
    colors <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">clone_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">p_cnv</span>, <span class="va">.</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">}</span>,
    plot.na <span class="op">=</span> <span class="cn">F</span>,
    plot.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">'Joint'</span>,
<span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'royalblue'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red3'</span>, midpoint <span class="op">=</span> <span class="fl">0.5</span>, name <span class="op">=</span> <span class="st">'Posterior'</span><span class="op">)</span>
<span class="va">p_allele</span> <span class="op">=</span> <span class="va">pagoda</span><span class="op">$</span><span class="fu">plotEmbedding</span><span class="op">(</span>
    alpha<span class="op">=</span><span class="fl">0.8</span>,
    size<span class="op">=</span><span class="fl">1</span>, 
    colors <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">clone_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">p_cnv_x</span>, <span class="va">.</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">}</span>,
    plot.na <span class="op">=</span> <span class="cn">F</span>,
    plot.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">'Expression'</span>,
<span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'royalblue'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red3'</span>, midpoint <span class="op">=</span> <span class="fl">0.5</span>, name <span class="op">=</span> <span class="st">'Posterior'</span><span class="op">)</span>
<span class="va">p_expr</span> <span class="op">=</span> <span class="va">pagoda</span><span class="op">$</span><span class="fu">plotEmbedding</span><span class="op">(</span>
    alpha<span class="op">=</span><span class="fl">0.8</span>,
    size<span class="op">=</span><span class="fl">1</span>, 
    colors <span class="op">=</span> <span class="va">nb</span><span class="op">$</span><span class="va">clone_post</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
        <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">p_cnv_y</span>, <span class="va">.</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">}</span>,
    plot.na <span class="op">=</span> <span class="cn">F</span>,
    show.legend <span class="op">=</span> <span class="cn">T</span>,
    plot.theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">'Allele'</span>,
<span class="op">)</span> <span class="op">+</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'royalblue'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red3'</span>, midpoint <span class="op">=</span> <span class="fl">0.5</span>, name <span class="op">=</span> <span class="st">'Posterior'</span><span class="op">)</span>
<span class="op">(</span><span class="va">p_expr</span> <span class="op">|</span> <span class="va">p_allele</span> <span class="op">|</span> <span class="va">p_joint</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">'collect'</span><span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-11-1.png" width="2700"> Both expression and allele signal clearly separate the tumor and normal cells.</p>
</div>
<div class="section level2">
<h2 id="tumor-phylogeny">Tumor phylogeny<a class="anchor" aria-label="anchor" href="#tumor-phylogeny"></a>
</h2>
<p>Let's take a closer look at the inferred single cell phylogeny and where the mutations occurred.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span><span class="op">$</span><span class="fu">plot_sc_tree</span><span class="op">(</span>
  label_size <span class="op">=</span> <span class="fl">3</span>, 
  branch_width <span class="op">=</span> <span class="fl">0.5</span>, 
  tip_length <span class="op">=</span> <span class="fl">0.5</span>,
  pal_clone <span class="op">=</span> <span class="va">mypal</span>, 
  tip <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-12-1.png" width="1800"> The mutational history can also be represented on the clone level, where cells with the same genotype are aggregated into one node.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span><span class="op">$</span><span class="fu">plot_mut_history</span><span class="op">(</span>pal <span class="op">=</span> <span class="va">mypal</span><span class="op">)</span></code></pre></div>
<p><img src="results_files/figure-html/unnamed-chunk-13-1.png" width="1800"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Teng Gao, Hirak Sarkar, Evan Biederstedt, Peter Kharchenko.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
